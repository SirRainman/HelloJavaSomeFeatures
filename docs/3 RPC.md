# RPC概述

![RPC调用过程](http://haoimg.hifool.cn//img/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NzMTIzbWxr,size_16,color_FFFFFF,t_70.png)

RPC 的核心功能主要有 5 个部分：

1. 客户端：服务调用方
2. 客户端 Stub：存放服务端地址信息，将客户端的请求参数数据信息打包成网络消息，再通过网络传输发送给服务端。
3. 网络传输：可以是 TCP、HTTP、HTTP2.0等
    1. 服务的调用方与服务的提供方建立 Socket 连接
    2. 服务的调用方通过 Socket 将需要调用的接口名称、方法名称和参数序列化后传递给服务的提供方
    3. 服务的提供方反序列化后再利用反射调用相关的方法。
4. 服务端 Stub：接收客户端发送过来的请求消息并进行解包，然后根据相应的信息调用本地服务进行处理。
5. 服务端：服务的真正提供者。



# RPC中设计到的方向：

1. 反射
2. 动态代理
    1. RPC 会自动给接口生成一个代理类，当我们在项目中注入接口的时候，运行过程中实际绑定的是这个接口生成的代理类。
    2. 在接口方法被调用的时候，它实际上是被生成代理类拦截到了，这样就可以在生成的代理类里面，加入远程调用逻辑。
3. 序列化
    1. 常见的序列化协议有哪些？
    2. Kryo原理
4. 网络传输协议
    1. Netty通信框架
    2. 如何实现内存零拷贝
5. 服务发现/注册
    1. 简单的动态代理和反射调用到其他微服务在多线程的情况下，可能会导致并发错乱，需要相关的服务注册中心（Eureka zookeeper） 进行服务发现，给相应的函数一个唯一的id
    2. 在 RPC 中，所有的函数都必须有自己的一个 ID。这个 ID 在所有进程中都是唯一确定的。客户端和服务端分别维护一个函数和Call ID的对应表。
        1. 客户端想要调用函数A，就查找自己所的对应表把A对应的ID通过存根传输
        2. 服务端根据ID在自己这边的表中找到函数，并执行
    3. 网络传输层需要把 Call ID 和序列化后的参数字节流传给服务端，然后再把序列化后的调用结果传回客户端。
6. 负载均衡
    1. 常见的负载均衡的算法有哪些？（Dubbo的四种负载均衡的策略）
7. 服务熔断



可能会问到的一些问题？

1. Zookeeper 
    1. 有几种角色？
    2. 节点宕机是怎么发现并剔除的
2. RPC中会涉及到IO模型吗？
3. NIO/BIO/AIO这些是做什么用的？
4. rpc框架之间的区别
5. 分布式一致性协议
    1. 2pc 3pc raft



# 常用的RPC框架

**Dubbo:** 阿里开源的一个高性能优秀的服务框架，目前 Dubbo 已经成为 Spring Cloud Alibaba 中的官方组件。 

**gRPC** ：gRPC 是可以在任何环境中运行的高性能RPC框架。可以通过可插拔的支持来有效地连接数据中心内和跨数据中心的服务，以实现负载平衡，跟踪，运行状况检查和身份验证。它也适用于分布式计算的最后一英里，以将设备，移动应用程序和浏览器连接到后端服务。 

**Hessian：** Hessian是一个轻量级的 remoting-on-http 工具，使用简单的方法提供了 RMI 的功能。 相比 WebService，Hessian 更简单、快捷。采用的是二进制 RPC协议，因为采用的是二进制协议，所以它很适合于发送二进制数据。



---



# 网络传输协议



# 序列化

# 负载均衡